<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-auth.js"></script>
    <script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"> </script> 
    <link rel="icon" type="image/png" href="Images/1228917a-cb83-495c-9f3a-c7bb035829f0_200x200.png"/>
    <title>Sahara</title>
</head>

<body id="body" style="background-repeat: no-repeat;" >
        <div style="margin-left: auto;margin-right: auto;width:80vw; ">
            
            <div class="white">
                <button id="rf" style="display: none;"></button>
                <div id="loading" class="test"></div>
                <a href="#"><img id="side_arrow" style="width:  1.5vw; height:  1.5vw;" src="Images/96997d58-285a-4f4a-8bce-b8eda73d343f_200x200.png" alt="Side Arrow"></a>
                <div  class="sidebar"id ="sidebar"> 
                    <ul class="No-List" >
                        <h4>Sahara</h4>
                        <li><a id="notes" style="text-decoration: none;" href="#"><img style=" width:  1.7vw; height:  1.7vw;" src="Images/note-black.png" alt="Mail">Notes </a> </li>
                        <li><a id="chatts" style="text-decoration: none;"href="#"><img style=" width:  1.5vw; height:  1.5vw;" src="Images/chat-black.png" alt="Chat">Chat </a> </li>
                        <li><a id="school"style="text-decoration: none;"href="#"><img style=" width:  1.5vw; height:  1.5vw;" src="Images/school-black.png" alt="School">School </a> </li>
                        <li><a id="timer"style="text-decoration: none; "href="#"><img style="width:  1.5vw; height:  1.5vw;" src="Images/timer-black.png" alt="Timer">Timer  </a> </li>
                        <li><a style="text-decoration: none; "href="mailto:samilaayouni@ifraneschool.org"><img style="width:  1.5vw; height:  1.5vw;" src="Images/8704ee09-e259-4154-93bd-3693dc162e82_200x200.png" alt="Contact_Us">Contact Us  </a> </li>
                    </ul>
                </div>
                
               
            <span>
                
                <img  class="Img"src="Images/1228917a-cb83-495c-9f3a-c7bb035829f0_200x200.png" alt="S">ahara
                <a  id ="Login"href="#" style="text-decoration: none;font-size:  0.9vw;color:cornsilk;margin-left: 15.625vw;display: none;" data-target="modal-login">Login</a>
                <a  id = "Signup" href="#" style="text-decoration: none;font-size:  0.9vw;color:cornsilk;display: none;" data-target="modal-signup">Sign up</a>
                <button id="Take_Picture"  style="display: none; background-color: transparent; border: none; margin-left: 13.28125vw;" ></button>
                <div class ="user_info"id="user_info"></div>
                <div class="dropdown" id="ButtonTo">
                    <div style="font-size: 2;"></div>
                    <button id="dropbutton" class="dropbutton"  style="float: left;"><img  id ="dropdow"style="width: 1.5vw; height:  1.5vw; display: none; " src="Images/3d8d4d35-1b0b-49cb-896f-b91e8ef003ad_200x200.png" alt="down arrow"></button></div>
                    
                    <div class="sidebarS" id="Chat_Data" style="display: none; position: absolute; margin-left: 954px; height: 320px; border: 1px solid black;"> 
                            <ol style="list-style-type: none;">
                                <li><img id="ImgOfPic" src="" alt="Profile_Picture2" style="width: 80px; height: 80px; margin-left: 40px; border-radius: 50%;"></li>
                                <li ><p id="POFPIC" style="display: block; font-size: 19px; margin-left: 40px;"></p></li>
                                <li><hr></li>
                                <li ><button id="noti" style=" border: none; background-color: transparent;"><img id="etuy" style="display: inline-block; width: 26px; height: 26px;" src="Images/2294246a-0052-4f8d-a5dc-462d939efafd_200x200.png"  alt=""><p style="display: inline; font-size: 16px; ">Notification</p></button> </li>
                                <li><hr></li>
                               
                                <li ><a id="Logout" style="text-decoration: none; font-size: 20px; margin-top: 10px; " href="#">Logout</a></li>
                            </ol>
                            
                            
                            
                     
                    </div>
                    
                </div>
                <div style="position: absolute;  bottom: 475px; left: 142px;" id="yuiut"><button style="margin-left: 125px;" id="ChatGoTo" class="city">Chat</button><button id="FriendGoTo" class="city">Friends</button></div>
            </span>
            
            
            
            
            
            
                
            </div>
            
            <div style="position: fixed; background-color: white; height: 350px; width: 350px; margin-left: 592px; display: none;" id="notiup" ><p style="text-align: center; padding-top: 5px; ">Notifications</p>
                <hr><p style=" font-size: 13px;">Friend Request </p><hr><div id="notiuj" style="overflow-y: scroll;"></div></div>
                <div style="margin-left: 139px; width: 1200px;">
            
                
            
            
            
            
                        <div style="display: none; margin-left: 120px; margin-top: 90px;" id="friendif"></div>
            </div>
                     
            
            
             
            <div  id="countdownTimer" style="display: none; margin-left: 100px;"> 
                <p id="countdown" class="countdown"></p>
                <div id="Timer">
                <p style="font-size: 1.7625vw; margin-left: 32.8125vw;"> Hours |  Minutes  |  Seconds</p>
                  <div>
                    
                    <input maxlength = "6" id="Messages" dir="rtl" style="font-size:  3.9vw; width: 20vw; margin-left: 32.03125vw; margin-bottom: 50px; text-align: center;" type="text" placeholder="00:00:00">
                  </div>
                </div>
                <div style="margin-left: 30px;" id="ShowFirstTime">
                    <button id="start" style=" width: 11.7vw; height: 5.4vw;  margin-left: 28.125vw;  ">Start</button>
                    <button id="cancelStart" style="width: 11.7vw; height: 5.4vw;">Cancel</button>
                </div>
                <div id="ShowNotFirstTime">
                    <button id="pause" style=" width: 11.7vw; height: 5.4vw; display: none; margin-left: 28.125vw; ">Pause</button>
                    <button id="unPause" style="width: 11.7vw; height: 5.4vw; display: none; margin-left:28.125vw;">Unpause</button>
                    <button id="cancelNotStart" style="width: 11.7vw; height:  5.4vw; display: none;" >Cancel</button>
                </div>
                
        </div>
        
        
            <main>
                <div id="All_The_Notepad_stuff" style="display: none; ">
                    <div style="margin-right: 30.3125vw;">
                        <button id="ClearButton"style="font-size: 12px; display: inline;"><img style="width: 1.5vw; height: 1.5vw;" src="Images/f53ee05a-c2eb-4286-9d44-1761d3a73c68_200x200.png" alt="Delete" ></button>
                        <button id="SaveButton"style=" font-size: 12px; display: inline;   "><img style="width: 1.5vw; height: 1.5vw;" src="Images/faac5ba7-cf5d-48b3-9dcd-685ee2ed2e48_200x200.png" alt="Save" ></button>
                        
                       
                        <button id="BlodButton"style="  font-size: 12px; display: inline;   "><img style="width: 1.5vw; height: 1.5vw;" src="Images/c471dd20-43ea-4a68-9772-0d73846b9ec9_200x200.png" alt="Bold" ></button>
                        <button  id="IButton"style="   font-size: 12px; display: inline;  "><img style="width: 1.5vw; height: 1.5vw;" src="Images/51828316-8524-427d-9eac-15827185084f_200x200.png" alt="I" ></button>
                    </div>
                    <div>
                    
                    <textarea style="border-radius: 12px; font-style: normal; font-family:Arial, Helvetica, sans-serif; outline: none; border: none; resize: none; width: 39vw; height: 39vw; margin-left: 100px; margin-top: 10px; "  id="textarea" cols="30" rows="10"></textarea>
                    <div  id="G" style=" background-color: gray; border-radius: 30px; height: 30px; width: 150px; margin-left: 270px; display: none; "><p id="Gp" style="color: white; text-align: center; padding-top: 5px; padding-bottom: 5px;"></p></div>
                </div>
                </div>
                
                <div  id="StuffTOHide">
                    <div  style="background-color:whitesmoke; width: 60vw; margin-bottom: 30px;" >
                        <span style="display: none;" id="showInClick">
                   
                            <button id="Add_User"  style="margin-left: -350px;  background-color: transparent; width: 6.2vw; height: 6.2vw; border: none; display: none;   "><img src="Images/0b8b84d5-4dd5-4f27-920d-56e03a52733e_200x200.png" alt="Add User"></button>
                        <p  style="display: inline-block; font-size: 20px; margin-right: -10px;" id="Chat_UID_h2"></p>
                        
                        <button id="3rty" style="background-color: transparent; border: none; width: 70px; height: 70px;"><img src="Images/7e7025e7-6afb-4b2c-9965-a41c142cfa29_200x200.png" alt="Picture Can't load"></button>
                        <button id="4rty" style="background-color: transparent; border: none; width: 70px; height: 70px;  margin-right: -100px;"><img src="Images/309ede65-1cce-4bab-9867-8ab11e634ea4_200x200.png" alt="Picture Can't load"></button>
                        </span>
                        
                    </div>

                    
                    <audio id="audio" src="telephone-ring-04.mp3" autoplay></audio>

                    <button id="edsz" style="background-color:transparent; border: none; margin-right: 700px; "><img style="width: 30px; height: 30px; " src="Images/x.png" alt=""></button> 
                    <div id="scroll" style="width: 60vw; height:  39vw; overflow: hidden; overflow-y: scroll;  display: none;" ><div id="Top"></div> <div id="Bottom"></div></div>
                    <form id="chat" class = "hideS">
                       
                       
                        <div style=" background-color: white; width: 50vw; height: 40px; border-top-left-radius: 10px; border-top-right-radius: 10px;"><button id="yuij"  style="border: none; background-color: transparent;"><img style=" width: 20px; height: 20px;" src="Images/3d8d4d35-1b0b-49cb-896f-b91e8ef003ad_200x200.png" alt=""></button>
                            <input id="Chat_input" style=" display: inline-block; width: 45vw; border: none; text-align: left; padding-top: 15px; background-color: white; outline: none;  " type="text" placeholder="Click here to start typing." ><button  style="height:30px ;   background-color: transparent; border: none; display: inline-block;" id="Chat_Button"><img src="Images/011d0169-927f-4de0-a0c7-d70faa725edc_200x200.png" alt="Send"></button></div> 
                            <div id="FHYUHDFIS" class="FHYUHDFIS">
                                
                                <div id="tyuij" style="display: none; border-top: 1px solid black; background-color: white; border-bottom-left-radius: 120px; border-bottom-right-radius: 120px; width: 50vw;"><button id="AddPicture" style="display: none; background-color: transparent; border: none;"><img style="width: 20px; height: 20px; " src="Images/908915e9-7479-4642-8a71-dc704f44bc78_200x200.png" alt="Upload An Image"></button>
                               
                                    <button id="Emoji_Picker" style="background-color: transparent; border: none; margin-top: 7px;" ><img style="width: 20px; height: 20px; " src="Images/3da8df44-25dc-4f83-b945-ffaf1ddb896d_200x200.png" alt="Emoji"></button></div>
                            </div>
                        <br><br><br><br>
                    </form>    
                </div> 
            </div>
                <div class="i" style="padding-top: 10px; background-color: black; color: white; display: none;"><p style="color: white; display: inline; margin-right: 100px;">Profile picture</p><p style="color: white; display: inline; margin-right: 60px;">Username</p>           <p style="display: inline; margin-left: 100px; color: white;">Friend since</p></div>
               
                <div id="ffg" style="width: 1000px; overflow-y: scroll;   height: 80px; ">
                    <div  style=" height: 10px;  display: inline-block;" id="allchatpic"></div> 
            </div>
            <button id="Plus_Sign" style=" display: inline-block; background-color: transparent; width:3.5vw; height:3.5vw; border: none; display: none;  "><img  style="width: 3.5vw; height: 3.5vw;" src="Images/1bbf2aba-6fb1-47bc-bc10-3b751e5f1337_200x200.png" alt="Plus sign"></button>
            <br><br>
            <div style=" width: 1000px;" id="All_The_chats">
            </div>    
                <h1 id="Welcome" class="hide" style="margin-top: 30px;">Welcome To Sahara</h1>
                <div id="StuffInChat">
                    <button  id="Back_button"style="background-color: transparent; border: none;  margin-right: 500px;  margin-bottom:50px;"><img style="width: 40px; height: 40px; display: none;" src="Images/2b31d65a-2474-4ac1-b9e6-5842d98a0144_200x200.png" alt="Back Button"></button>
                </div>    
            </div>    
            </main>
            
        <div id ="signup" class="modal-boss-s">
            <div class="modal-signup">
                <div  id ="modal-boss-sc"class="close">+</div> 
                <form class="list">
                    <h1 style="font-size: 3.7vw;">Sign Up</h1></li>
                    <input style="width: 20vw; margin-top: 1vw;" class ="form"type="text" id ="signup-first-name" placeholder="Enter First Name">
                    <input style="width: 20vw;" class ="form"type="text" id="signup-last-name" placeholder="Enter Last name">
                    <input style="width: 20vw;"class ="form"type="email" id ="signup-email" placeholder="Enter Username">
                    <input style="width: 20vw;"class ="form"type="password" id="signup-password" placeholder="Enter Password">
                    <p style="color: red; font-size: 0.9vw;" id="catchErrorSignup"></p>
                    <button  style="width: 7vw;" class ="form" id="Sign Up"><p  style="font-size: 0.7vw;">Sign Up</p></button></li>
                </form>
            </div>
        </div>
        <div id ="login" class="modal-boss-l">
            <div class="modal-login">
                <div  id ="modal-boss-lc"class="close">+</div>
                <form class="list">
                    <h1 style="font-size: 3.7vw;">Login</h1></li>
                    <input style="width: 20vw; " class ="form" type="email" id ="login-email" placeholder="Enter Username">
                    <input  style="width: 20vw;" class ="form" type="password" id="login-password" placeholder="Enter Password">
                    <p style="color: red; font-size: 0.9vw;" id="catchErrorLogin"></p>
                    <button  style="width: 7vw;" class ="form"id="Login"><p style="font-size: 0.7vw;">Login</p></button>
                </form>
            </div>
        </div> 
        <div id ="Back_buttonModal" class="modal-boss-s">
            <div class="modal-signup" style="height: 16.6vw;">
                <div  id ="CloseBack_button"class="close">+</div>
                <form class="list">
                    <h1>Create A Chat</h1></li>
                    <input class ="form"type="text" id ="CreateChatFirstName" placeholder="Enter Name">
                    <input  id="CreateChatFile"type="file">
                    <button class ="form" id="CreateChat" style="margin-top: 20px;">Create Chat</button></li>
                </form>
            </div>
        </div> 
        <img src="" alt="">
            <div id="InviteFriendModal" class="modal-boss-s">
            <div class="modal-signup" style="height: 15.6vw;">
                <div  id ="CloseInviteFriend"class="close">+</div>
                <form class="list">
                    <h1>Invite a Friend</h1></li>
                    <input class ="form"type="text" id ="InviteUsername" placeholder="Enter your friends username">
                    <button class ="form" id="Invite">Invite</button></li>
                </form>
            </div>
        </div>
        <div id="trty"></div><img id="addfriend" style="display: none;  width: 60px; height: 60px; margin-left: 1250px;" src="Images/1bbf2aba-6fb1-47bc-bc10-3b751e5f1337_200x200.png" alt="">
        </div>
        <div id="ProfilePictureModal" class="modal-boss-s">
            <div class="modal-signup" style="height: 11.7vw;">
                <div  id ="CloseProfilePicture"class="close">+</div>
                <form class="list">
                    <li><h1>Profile</h1></li>
                   <button id="TakeAProfielPicture"style="width: 11.7vw; height: 1.9vw; margin-top: 5px;">Take a Picture</button>
                   <button  id="UploadAProfielPicture"style="width: 11.7vw; height: 1.9vw; margin-top: 5px;">Upload an Image</button>
                </form> 
            </div>
        </div>
        <div id="erg" style="display: none; backdrop-filter: blur(5px); " class="modal-boss-sc"><div id="ety"  style="display: none; border:2px solid white; backdrop-filter: blur(5px); width: 450px; height: 490px; margin-top: 100px; margin-left: 420px;">
            <div style="background-color:white;"><h1 id="ro" style="color: black; margin-left: 120px;"></h1> </div>
           <img style="margin-left: 95px; width: 265px; height: 265px; border-radius: 50%;" id="rts" src="" alt="">
           <div style=" background-color: rgba(0, 0, 0, 0.247); height: 122px;  margin-top: 20px;">
            <button id="3erdt" style=" margin-left: 50px; border: none; background-color: transparent;"><img style="width:70px; height:70px; margin-top: 40px;" src="Images/de33965d-eb14-452a-8772-9aa3afdcefab_200x200.png" alt=""> </button> 
            <button id="4erdt" style=" margin-left: 200px; height: 80px; border: none; background-color: transparent;"><img style="width:70px; height:70px; " src="Images/6bf209c1-4d10-491a-812d-8a7c03798eea_200x200.png" alt=""></button></div></div></div> 
        <div id="ProfilePictureModalU" class="modal-boss-s">
            <div class="modal-signup" style="height: 11.7vw;">
                <div  id ="CloseProfilePictureU"class="close">+</div>
                <form class="list">
                    <li><h1>Upload an Image</h1></li>
                    <input  id="file"type='file' />
                </form>
            </div>
        </div>
        
        <div style="position: fixed;" id="addfriendU" class="modal-boss-s">
            <div  class="modal-signup" style="height: 11.7vw;">
                <div  id ="addfriendcloseU"class="close">+</div>
                <form class="list">
                    <li><h1>Add a friend</h1></li>
                    <input id="friendentername" type="text" placeholder="Enter your friend's name">
                    <br>
                    <button id="enteraddfriend" style="margin-top: 8px; width: 80px; height: 30px;">Enter</button>
                </form>
            </div>
        </div>
        <div id="AddPictureModal" class="modal-boss-s">
            <div class="modal-signup" style="height: 11.7vw;">
                <div  id ="CloseAddPicture"class="close">+</div>
                <form class="list">
                    <li><h1>Upload Image</h1></li>
                   <button  id="UploadAAdd"style="width: 11.7vw; height: 1.9vw; margin-top: 5px;">Upload an Image</button>
                </form>
            </div>
        </div>
        <div id="AddModalU" class="modal-boss-s">
            <div class="modal-signup" style="height: 11.7vw;">
                <div  id ="CloseAddU"class="close">x</div>
                <form class="list">
                    <li><h1>Upload an Image</h1></li>
                    <input  id="fileAdd"type='file' />
                </form>
            </div>
        </div>
        <div id="BackgroundU" class="modal-boss-s">
            <div class="modal-signup" style="height: 11.7vw;">
                <div  id ="CloseBackgroundU"class="close">+</div>
                <form class="list">
                    <li><h1>Upload an Image</h1></li>
                    <input  id="fileAddBackground"type='file' />
                </form>
            </div>
        </div>
</body>
<script>
        var firebaseConfig = {
            apiKey: "AIzaSyCoK1APEkbi7HzfGekPgAVX8l8q6BLmL50",
            authDomain: "sahara-8bfbe.firebaseapp.com",
            databaseURL: "https://sahara-8bfbe.firebaseio.com",
            projectId: "sahara-8bfbe",
            storageBucket: "sahara-8bfbe.appspot.com",
            messagingSenderId: "247681289351",
            appId: "1:247681289351:web:c75c7b2fc405a19e1e3c22",
            measurementId: "G-Q1E5WQHV8G"
        };
        firebase.initializeApp(firebaseConfig);
        const firestore = firebase.firestore();
        const auth = firebase.auth();
        const input = document.getElementById("Chat_input");
        let NotInChat = true;
</script>
<script>src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"</script>
<script src="index.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emoji-button@latest/dist/index.min.js"></script>
<script>
// Hiding some stuff.
Back_button.style.display = 'none';
document.getElementById("Chat_input").style.display = "none";
document.getElementById("Chat_Button").style.display = "none";
//Getting the username from local storage.
let user = localStorage.getItem('user');
//This function will run when somebody clicks a chat.
function JoinChat1(Chat_Id){ 
    sessionStorage.setItem("Chat_Name", Chat_Id);
    sessionStorage.setItem("Chat_currently_in", Chat_Id)
    document.getElementById('ChatGoTo').style.display = "none";
    FriendGoTo.style.display = "none";
    //Hiding stuff and showing all the chat stuff
    let fgp = 0
    document.getElementById('showInClick').style.display = "block";
    document.getElementById("All_The_chats").style.display = "none";
    document.getElementById("Bottom").style.display = "block";
    document.getElementById('chat').style.display = "block";
    document.getElementById('scroll').style.display = "block";
    document.getElementById('Bottom').innerHTML = ""
    document.getElementById('FHYUHDFIS').style.display = "block-inline"
    document.getElementById('StuffTOHide').style.display = "inline";
    document.getElementById('Add_User').style.display = "inline-block";
    document.getElementById('AddPicture').style.display = "inline";
    document.getElementById("Chat_input").style.display = "inline";
    document.getElementById("Chat_Button").style.display = "inline";
    document.getElementById("Back_button").style.display = "inline";
    document.getElementById('Plus_Sign').style.display = "none"; 
    document.getElementById('allchatpic').style.display = "none";
   
    
    call();
    
   
    
   
    
    
    
    //This code is the emoji button.
    const Emoji_Picker = document.getElementById('Emoji_Picker');
    var input = document.querySelector('#Chat_input');
        var picker = new EmojiButton({
            position: 'bottom'
        });
        //When the emoji button is clicked it will show if not already showing and hide is showing.
    Emoji_Picker.addEventListener('click',function(e){
        e.preventDefault()
        picker.pickerVisible ? picker.hidePicker() : picker.showPicker(InputEvent)
        //When the user has chosen an emoji it will be added to the input field.
        picker.on('emoji', function(emoji){
            input.value += emoji
        });
    });
    const inut = document.getElementById('Chat_input')
    inut.addEventListener("keyup", function(event) {
        // Number 13 is the "Enter" key on the keyboard
        if (event.keyCode === 13) {
            // Cancel the default action, if needed
            event.preventDefault();
            // Trigger the button element with a click
            document.getElementById("Chat_Button").click();
        }
        });
    
   
    //Making an array
    let ARRAY = [];
    //Just making sure the chat is not equal to nothing.
    if(Chat_Id != ""){
        //Gets the name of the chat that we just joined.
        const Chat_currently_in = Chat_Id;
        sessionStorage.setItem("Chat_Name", Chat_Id);
        //This is the chat name.
        const Chat_UID_h2html = `${Chat_currently_in}`;
        document.getElementById('Chat_UID_h2').innerHTML = Chat_UID_h2html;
        //This function runs
        GetFirstThenNext("Bottom");
        
        function GetFirstThenNext(){
        let user = localStorage.getItem('user');
        //This will get 30 messages where the field IsMesssage = false.
        NotInChat = false;
            firestore.collection(Chat_currently_in).where("IsMessage", "==", false).get().then(snap => {
                
                let rf = snap.size
                let data = snap.docs
                let r = []
                data.forEach(doc => {
                
                //We add all the doc.id to the array and then order it so it will not be in a mess.
                    r.push(doc.id);
                })
                r.sort()
                if(rf > 30){
                    
                    let g = rf - 30;
                   
                    for (let i = 0; i < g; i++) {
                        firestore.collection(Chat_currently_in).doc(r[i]).delete()
                        
                    }
                   fgp = 1 
                }
            })
            
            setTimeout(function(){
                firestore.collection(Chat_currently_in).where("IsMessage", "==", false).limit(30).get().then(snapshot =>{
            //Another function is called and the parameter is all the docs that this function got.
                Text(snapshot.docs);
               
            });

            }, 800)    
            
            
        const Text = (data) =>{
            //data is the data in each message.
            let htmlForText = '';
            //For ever doc/Message this function will run.
            data.forEach(doc => {
                
                //We add all the doc.id to the array and then order it so it will not be in a mess.
                ARRAY.push(doc.id);
                ARRAY.sort();
                });
                //These arrays are for the thumbs up.
                const Thumbs = [];
                const Thumbs2 = [];
                //This for loop runs for every index inside the arrays full of doc.ids
                for (let i = 0; i < ARRAY.length; i++) {
                //The rest just takes the doc and displays it in the chat box.
                const Doc = ARRAY[i]
                
                firestore.collection(Chat_currently_in).doc(Doc).get().then(snapshot=>{
                    //The message send is stored in Texts.
                    const Texts = snapshot.data();
                    const Tex = snapshot;
                    const Ref = firestore.collection(Chat_currently_in).doc("Messages");
                    //The number of charcters in the Number_Of_Characters.
                    const Number_Of_Characters = Texts.Number_Of_Characters;
                    //This gets the user that send the message dislay name.
                    firestore.collection("users").doc(user).get().then(function(doc) //2
                    {
                            const MessageBoxr = document.getElementById("Bottom")
                            let Data = doc.data();
                            let Display_Name = Data.Display_Name
                            Ref.update({
                                Display_Name: Display_Name
                            });
                            //This finds out how long ago the message was send.
                            let CurrentDate = new Date();
                            let CurrentDate_mili = CurrentDate.getTime();
                            let mili = Math.abs(Texts.Date_mili);
                            let Diffrence_mili = CurrentDate_mili - mili;
                            let Diffrence_Years = Math.floor(Diffrence_mili/ 31556952000);
                            let Diffrence_Monthes = Math.floor(Diffrence_mili/2629746000);
                            if(Diffrence_Monthes > 12){
                                Diffrence_Monthes -= 12
                            }else if(Diffrence_Monthes == 12){
                                Diffrence_Monthes =1
                            }
                            let Diffrence_Days =  Math.floor(Diffrence_mili / (24*60*60*1000));
                            let daysms= Diffrence_mili % (24*60*60*1000);
                            let Diffrence_hours = Math.floor((daysms)/(60*60*1000)); 
                            let hoursms=Diffrence_mili % (60*60*1000);
                            let Diffrence_minutes = Math.floor((hoursms)/(60*1000));
                            //Seeing the diffrence in miliseconds and saying how long ago the message was sent based on that data.
                            if(Diffrence_mili < 60000){
                                let Datehtml = " Just now!";
                                GetData(Datehtml);
                            }
                            else if (Diffrence_mili > 60000 && Diffrence_mili < 3600000){
                                if(Diffrence_minutes <= 0){
                                    let Datehtml = Diffrence_minutes + 60 + "m";
                                    GetData(Datehtml);
                                }
                                else{
                                
                                    let Datehtml = Diffrence_minutes + "m";
                                    GetData(Datehtml);
                                }
                            }
                            else if (Diffrence_mili> 3600000 && Diffrence_mili< 86400000){
                                    
                                        let Datehtml = Diffrence_hours + "h";
                                        GetData(Datehtml);
                                      
                            }
                            else if (Diffrence_mili > 86400000){
                                
                                
                                    
                                        let Datehtml = Diffrence_Days + "d";
                                        GetData(Datehtml);
                                      
                            }
                            else{
                               
                                let Datehtml = Diffrence_Days + Diffrence_Monthes + Diffrence_Years;
                                GetData(Datehtml);
                            }
                            //Functiob GetData that takes a parameter of Datehtml which was the result of the time thing.
                            //This function display the message.
                            function GetData(Datehtml){
                                    let useremail = localStorage.getItem('user.email');
                                    let rty = localStorage.getItem('user')
                                    const Data = doc.data();
                                    const Profile = Data.Profile;
                                    firestore.collection("users").doc(user).get().then(function(doc){
                                                const Data = doc.data();
                                                const Profile_base64 = Data.Profile;
                                                localStorage.setItem('Profile_base64', Profile_base64)
                                    });
                                    //If it is an image this will run.
                                    if(Texts.ImageSrc){
                                                    if(Texts.WhoIsTheMessageFrom == rty){    
                                                        
                                                        //If the person signed in is the person who send the message this will run.
                                                    
                                                        const Profile_base64 =  localStorage.getItem('Profile_base64')                 
                                                    const htmlForTexth = `
                                                    <div class="Go"><img class="inline" src=${Profile_base64} alt="User Profile"><p class="real_inline">You:</p></div>
                                                    <div  id="Message_SendLC1" class="left" style = "height: 15.6vw; width:15.6vw;"><p class="go_to_spot">${Datehtml}</p><p class="Center"><img style="width: 150px; height: 150px;" src="${Texts.ImageSrc}" alt="Profile Picture"></img>
                                                        <br></div>
                                                    `;
                                                    setTimeout(function(){
                                                        MessageBoxr.innerHTML += htmlForTexth;
                                                    }, 1)  
                                                    
                                                    
                                                   
                                                                       
                                                    //''''''''''''''''''''''''''''''''''''''''''''''''
                                                    }else{  
                                                        firestore.collection('users').doc(Texts.WhoIsTheMessageFrom).get().then(snapshot =>{
                                                                            const moreData =snapshot.data();
                                                                            const Profile_bas64Ny = moreData.Profile 
                                                                            const Display_Name = moreData.Display_Name
                                                                            const htmlForTexth = `
                                                                            <div class="GoR" "><img class="inline" src=${Profile_bas64Ny} alt="User Profile"><p class="inlineR">${Display_Name}</p></div>
                                                                            <div  id="Message_SendRC1" class="right" style = "heigth: 15.6vw; width:15.6vw;"><p class="go_to_spot">${Datehtml}</p></p><img style="width: 150px; height: 150px;" src="${Texts.ImageSrc}" alt="Profile Picture"></img>
                                                                                <br></div> 
                                                                            
                                                                        `;
                                                                            
                                                                        MessageBoxr.innerHTML += htmlForTexth;  
                                                                         
                                                                        });  
                                                        
                                                
                                            }//End of the else statement  
                                        //End of the if statement
                                    //End of the get method
                                    }else{
                                        if(Texts.WhoIsTheMessageFrom == rty){
                                            
                                        
                                        //Making the message out of all the data we got and posting it.
                                        const htmlForTexth = `
                                        <div class="Go"><img class="inline" src=${Profile} alt="User Profile"><p class="real_inline">You:</p></div>
                                        <div  id="Message_SendLC1" class="left" style = " width:auto; height:auto;"><p class="go_to_spot">${Datehtml}</p><p class="Center">${Texts.Message} 
                                        <br>   </div>
                                    `;
                                    
                                        setTimeout(function(){
                                            MessageBoxr.innerHTML += htmlForTexth;
                                        }, 1) 
                                    
                                   
                                   
                                                    
                                    }else{
                                        
                                                                
                                        firestore.collection('users').doc(rty).get().then(snapshot =>{
                                                    const moreData =snapshot.data();
                                                     const Profile_bas64Ny = moreData.Profile
                                                    
                                                    
                                                    const htmlForTexth = `
                                                    <div class="GoR" "><img class="inline" src=${Profile_bas64Ny} alt="User Profile"><p class="inlineR">${Display_Name}</p></div>
                                                    <div  id="Message_SendR1C" class="right" "><p class="go_to_spot">${Datehtml}</p></p>${Texts.Message}
                                                    <br></div> 
                                                `
                                                                                        
                                                    MessageBoxr.innerHTML += htmlForTexth;
                                                                                            
                                                   
                                                                       
                                                    });
                                                                                                

                                        }

                               
                               
                                var chat = document.getElementById("scroll");
                                chat.scrollTop = chat.scrollHeight;
                                document.getElementById("Chat_input").value = "";
                            }
                            
                                
                                                                                    
                                                                                    
                                                                                
                        }
                    
                    });
                
       
                   
                });
                }
          }
        }
    }
    
}


</script>
<script>
    
    
     
</script>
<script src="authChat.js"></script>

</html>